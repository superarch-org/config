#!/bin/sh
set -eu

# Figure out focused app_id (niri IPC JSON)
app_id="$(niri msg -j focused-window 2>/dev/null | jq -r '.app_id // ""' 2>/dev/null || true)"

is_term=0
case "$app_id" in
  Alacritty|kitty|foot|org.wezfurlong.wezterm|org.gnome.Terminal|com.mitchellh.ghostty)
    is_term=1 ;;
esac

notify_copy() {
  command -v notify-send >/dev/null 2>&1 || return 0
  # Replace prior "Copied" notification instead of stacking spam
  notify-send -t 3000 -h string:x-canonical-private-synchronous:uniclip "Copied"
}

copy_gui()  { wtype -M ctrl c -m ctrl; }
paste_gui() { wtype -M ctrl v -m ctrl; }

copy_term()  { wtype -M ctrl -M shift c -m shift -m ctrl; }
paste_term() { wtype -M ctrl -M shift v -m shift -m ctrl; }

case "${1:-}" in
  copy)
    [ "$is_term" -eq 1 ] && copy_term || copy_gui
    notify_copy
    ;;
  paste)
    [ "$is_term" -eq 1 ] && paste_term || paste_gui
    ;;
  cut)
    if [ "$is_term" -eq 1 ]; then
      notify-send "uniclip" "Cut disabled in terminal"
      exit 0
    else
      wtype -M ctrl x -m ctrl
    fi
    ;;
  *)
    echo "usage: uniclip {copy|paste|cut}" >&2
    exit 2
    ;;
esac
